import { Component, OnInit } from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { BaseSaveComponent } from 'src/app/shared/BaseSaveComponent';
import { UserService } from 'src/app/services/user.service';
import { Router } from '@angular/router';
import { ProfileService } from 'src/app/services/profile.service';
import { DragulaService } from 'ng2-dragula';
import { Subscription } from 'rxjs';

@Component({
  selector: 'app-onboarding1.3',
  templateUrl: './onboarding1.3.component.html',
  styleUrls: ['./onboarding1.3.component.css']
})
export class Onboarding13Component extends BaseSaveComponent implements OnInit {
  loading = false;
  form: FormGroup<any> = new FormGroup({
    socialWhatsapp: new FormControl(""),
    socialFacebook: new FormControl(""),
    socialInstagram: new FormControl(""),
    socialTwitter: new FormControl(""),
    socialYoutube: new FormControl(""),


  }, { updateOn: 'submit' });


  profile: any
  subs = new Subscription();
  edit:any
  errorAlert:boolean=false;
  editFromProfile: string = "";
  saveExsit:boolean=false;
  items: any = [
    { type: 1, data: 'Whatsapp', svgWidth:"19",svgHeight:"19", formControlName: "socialWhatsapp", placeholder: "Enter your Whatsapp No", id1: "wDownArrow", id2: "wUpArrow", inputId:"wInput", path: "M16.2312 2.76455C15.3558 1.88478 14.3132 1.18724 13.1641 0.712603C12.015 0.237969 10.7824 -0.0042561 9.53819 5.6591e-05C4.32513 5.6591e-05 0.0763821 4.22754 0.0763821 9.41453C0.0763821 11.077 0.515578 12.692 1.33668 14.117L0 19L5.01256 17.689C6.39698 18.4395 7.95327 18.8385 9.53819 18.8385C14.7513 18.8385 19 14.611 19 9.42403C19 6.90654 18.0166 4.54104 16.2312 2.76455ZM9.53819 17.2425C8.12512 17.2425 6.7407 16.8625 5.52814 16.15L5.24171 15.979L2.26281 16.758L3.05528 13.87L2.86432 13.5755C2.07925 12.3281 1.66239 10.8863 1.66131 9.41453C1.66131 5.10154 5.19397 1.58655 9.52864 1.58655C11.6291 1.58655 13.6055 2.40355 15.0854 3.88555C15.8182 4.61131 16.3989 5.47457 16.7939 6.42529C17.1889 7.37601 17.3903 8.39528 17.3864 9.42403C17.4055 13.737 13.8729 17.2425 9.53819 17.2425ZM13.8538 11.3905C13.6151 11.2765 12.4502 10.7065 12.2402 10.621C12.0206 10.545 11.8678 10.507 11.7055 10.735C11.5432 10.9725 11.0945 11.5045 10.9608 11.6565C10.8271 11.818 10.6839 11.837 10.4452 11.7135C10.2065 11.5995 9.44271 11.343 8.54523 10.545C7.83869 9.91803 7.37085 9.14853 7.22764 8.91103C7.09397 8.67353 7.20854 8.55003 7.33266 8.42653C7.43769 8.32203 7.57136 8.15103 7.68593 8.01803C7.8005 7.88503 7.84824 7.78053 7.92462 7.62853C8.001 7.46703 7.96281 7.33404 7.90553 7.22004C7.84824 7.10604 7.37085 5.94704 7.1799 5.47204C6.98894 5.01604 6.78844 5.07304 6.64523 5.06354H6.18693C6.02462 5.06354 5.77638 5.12054 5.55678 5.35804C5.34673 5.59554 4.73568 6.16554 4.73568 7.32453C4.73568 8.48353 5.58543 9.60453 5.7 9.75653C5.81457 9.91803 7.37085 12.293 9.73869 13.3095C10.302 13.5565 10.7412 13.699 11.0849 13.8035C11.6482 13.984 12.1638 13.9555 12.5744 13.8985C13.0327 13.832 13.9779 13.3285 14.1688 12.7775C14.3693 12.2265 14.3693 11.761 14.3025 11.6565C14.2357 11.552 14.0925 11.5045 13.8538 11.3905Z" },
    { type: 2, data: 'Facebook', svgWidth:"23",svgHeight:"23", formControlName: "socialFacebook", placeholder: "Enter your Facebook Email", id1: "fDownArrow", id2: "fUpArrow", inputId:"fInput", path: "M9.82868 3.81803H12V0.161034C10.9487 0.0521835 9.89238 -0.00155742 8.83542 3.43437e-05C5.69394 3.43437e-05 3.54572 1.90903 3.54572 5.40503V8.41802H0V12.512H3.54572V23H7.79596V12.512H11.3301L11.8614 8.41802H7.79596V5.80753C7.79596 4.60003 8.11935 3.81803 9.82868 3.81803Z" },
    { type: 3, data: 'Instagram',svgWidth:"21",svgHeight:"19", formControlName: "socialInstagram", placeholder: "Enter your Instagram Email", id1: "iDownArrow", id2: "iUpArrow",inputId:"iInput", path: "M6.09 0H14.91C18.27 0 21 2.47 21 5.51V13.49C21 14.9513 20.3584 16.3528 19.2163 17.3862C18.0742 18.4195 16.5252 19 14.91 19H6.09C2.73 19 0 16.53 0 13.49V5.51C0 4.04866 0.641623 2.64717 1.78372 1.61384C2.92582 0.580516 4.47483 0 6.09 0ZM5.88 1.9C4.87748 1.9 3.91602 2.26032 3.20714 2.90169C2.49825 3.54307 2.1 4.41296 2.1 5.32V13.68C2.1 15.5705 3.7905 17.1 5.88 17.1H15.12C16.1225 17.1 17.084 16.7397 17.7929 16.0983C18.5018 15.4569 18.9 14.587 18.9 13.68V5.32C18.9 3.4295 17.2095 1.9 15.12 1.9H5.88ZM16.0125 3.325C16.3606 3.325 16.6944 3.45011 16.9406 3.67281C17.1867 3.89551 17.325 4.19756 17.325 4.5125C17.325 4.82744 17.1867 5.12949 16.9406 5.35219C16.6944 5.57489 16.3606 5.7 16.0125 5.7C15.6644 5.7 15.3306 5.57489 15.0844 5.35219C14.8383 5.12949 14.7 4.82744 14.7 4.5125C14.7 4.19756 14.8383 3.89551 15.0844 3.67281C15.3306 3.45011 15.6644 3.325 16.0125 3.325ZM10.5 4.75C11.8924 4.75 13.2277 5.25044 14.2123 6.14124C15.1969 7.03204 15.75 8.24022 15.75 9.5C15.75 10.7598 15.1969 11.968 14.2123 12.8588C13.2277 13.7496 11.8924 14.25 10.5 14.25C9.10761 14.25 7.77225 13.7496 6.78769 12.8588C5.80312 11.968 5.25 10.7598 5.25 9.5C5.25 8.24022 5.80312 7.03204 6.78769 6.14124C7.77225 5.25044 9.10761 4.75 10.5 4.75ZM10.5 6.65C9.66457 6.65 8.86335 6.95027 8.27261 7.48475C7.68187 8.01922 7.35 8.74413 7.35 9.5C7.35 10.2559 7.68187 10.9808 8.27261 11.5153C8.86335 12.0497 9.66457 12.35 10.5 12.35C11.3354 12.35 12.1366 12.0497 12.7274 11.5153C13.3181 10.9808 13.65 10.2559 13.65 9.5C13.65 8.74413 13.3181 8.01922 12.7274 7.48475C12.1366 6.95027 11.3354 6.65 10.5 6.65Z" },
    { type: 4, data: 'Twitter',svgWidth:"19",svgHeight:"17", formControlName: "socialTwitter", placeholder: "Enter your Twitter Email", id1: "tDownArrow", id2: "tUpArrow",inputId:"tInput", path: "M18.8022 3.33809L16.1763 6.00318C15.6545 12.1922 10.5243 17 4.39409 17C3.13327 17 2.08983 16.7964 1.29855 16.3979C0.663794 16.0703 0.402934 15.725 0.333371 15.6188C0.275817 15.5297 0.23873 15.4287 0.224874 15.323C0.211018 15.2174 0.22075 15.1099 0.253346 15.0086C0.285941 14.9074 0.34056 14.8149 0.413132 14.7381C0.485703 14.6613 0.574358 14.6022 0.672489 14.5651C0.68988 14.5563 2.74198 13.7594 4.07236 12.2276C3.2473 11.6294 2.52212 10.9 1.92462 10.0672C0.733357 8.42035 -0.527466 5.56047 0.229027 1.29279C0.252808 1.16591 0.309798 1.04793 0.393976 0.951307C0.478154 0.854682 0.586396 0.783 0.70727 0.74383C0.82853 0.703399 0.958374 0.697708 1.0826 0.727379C1.20682 0.75705 1.32064 0.820939 1.41159 0.912058C1.43768 0.947474 4.33322 3.85163 7.87222 4.79016V4.25006C7.87564 3.68846 7.98765 3.13303 8.20188 2.61551C8.4161 2.09799 8.72833 1.6285 9.12075 1.23385C9.51316 0.839197 9.97808 0.527118 10.4889 0.315428C10.9998 0.103738 11.5466 -0.00341606 12.0982 8.30097e-05C12.822 0.0105957 13.5309 0.211858 14.1557 0.584261C14.7804 0.956663 15.2998 1.48751 15.6632 2.12507H18.3066C18.444 2.12464 18.5783 2.1656 18.6928 2.24281C18.8074 2.32002 18.8969 2.43001 18.9501 2.55893C19.0002 2.68976 19.0129 2.83237 18.9867 2.97026C18.9606 3.10815 18.8966 3.23567 18.8022 3.33809Z" },
    { type: 5, data: ' Youtube',svgWidth:"23",svgHeight:"18", formControlName: "socialYoutube", placeholder: "Enter your Youtube Email", id1: "yDownArrow", id2: "yUpArrow",inputId:"yInput", path: "M15.1905 8.4743L10.1723 5.10982C10.0778 5.04724 9.96822 5.01153 9.8552 5.00646C9.74217 5.0014 9.62989 5.02717 9.53024 5.08105C9.43059 5.13493 9.34728 5.21491 9.28915 5.31252C9.23101 5.41013 9.20021 5.52174 9.2 5.63552V12.3645C9.20013 12.4792 9.23134 12.5917 9.29029 12.6898C9.34923 12.788 9.43368 12.8682 9.53454 12.9217C9.63359 12.9755 9.74537 13.001 9.85778 12.9954C9.97019 12.9898 10.079 12.9534 10.1723 12.8902L15.1905 9.5257C15.2767 9.46815 15.3475 9.39004 15.3964 9.29831C15.4454 9.20658 15.471 9.1041 15.471 9C15.471 8.8959 15.4454 8.79342 15.3964 8.70169C15.3475 8.60996 15.2767 8.53184 15.1905 8.4743ZM10.4545 11.1869V6.81309L13.7164 9L10.4545 11.1869ZM22.4145 2.93342C22.3236 2.57857 22.1501 2.25053 21.9083 1.97634C21.6666 1.70214 21.3635 1.48964 21.0241 1.35632C17.4591 -0.0210098 11.7405 1.84615e-05 11.5 1.84615e-05C11.2595 1.84615e-05 5.54091 -0.0210098 1.97591 1.35632C1.63649 1.48964 1.33343 1.70214 1.09168 1.97634C0.849935 2.25053 0.676428 2.57857 0.585455 2.93342C0.313636 3.9638 0 5.85631 0 9C0 12.1437 0.313636 14.0362 0.585455 15.0666C0.676428 15.4214 0.849935 15.7495 1.09168 16.0237C1.33343 16.2979 1.63649 16.5104 1.97591 16.6437C5.54091 18.021 11.2595 18 11.5 18H11.5732C12.2945 18 17.6264 17.9579 21.0241 16.6437C21.3635 16.5104 21.6666 16.2979 21.9083 16.0237C22.1501 15.7495 22.3236 15.4214 22.4145 15.0666C22.6864 14.0362 23 12.1437 23 9C23 5.85631 22.6864 3.9638 22.4145 2.93342ZM21.2018 14.7512C21.1607 14.9116 21.0824 15.06 20.9734 15.1843C20.8644 15.3085 20.7277 15.4051 20.5745 15.4661C17.2291 16.7593 11.5627 16.7383 11.5 16.7383C11.4373 16.7383 5.77091 16.7593 2.42545 15.4661C2.27228 15.4051 2.13561 15.3085 2.0266 15.1843C1.91759 15.06 1.83932 14.9116 1.79818 14.7512C1.54727 13.7839 1.25455 12.007 1.25455 9C1.25455 5.993 1.54727 4.21613 1.79818 3.24884C1.83932 3.08839 1.91759 2.93999 2.0266 2.81575C2.13561 2.6915 2.27228 2.59492 2.42545 2.53389C5.77091 1.24067 11.4373 1.2617 11.5 1.2617C11.5627 1.2617 17.2291 1.24067 20.5745 2.53389C20.7277 2.59492 20.8644 2.6915 20.9734 2.81575C21.0824 2.93999 21.1607 3.08839 21.2018 3.24884C21.4527 4.21613 21.7455 5.993 21.7455 9C21.7455 12.007 21.4527 13.7839 21.2018 14.7512Z" },
  ];
  constructor(private userService: UserService,

    private router: Router,
    private profileService: ProfileService,
    private dragulaService: DragulaService,
  ) {
    super();
   


  }

  check() {
    return "M16.2312 2.76455C15.3558 1.88478 14.3132 1.18724 13.1641 0.712603C12.015 0.237969 10.7824 -0.0042561 9.53819 5.6591e-05C4.32513 5.6591e-05 0.0763821 4.22754 0.0763821 9.41453C0.0763821 11.077 0.515578 12.692 1.33668 14.117L0 19L5.01256 17.689C6.39698 18.4395 7.95327 18.8385 9.53819 18.8385C14.7513 18.8385 19 14.611 19 9.42403C19 6.90654 18.0166 4.54104 16.2312 2.76455ZM9.53819 17.2425C8.12512 17.2425 6.7407 16.8625 5.52814 16.15L5.24171 15.979L2.26281 16.758L3.05528 13.87L2.86432 13.5755C2.07925 12.3281 1.66239 10.8863 1.66131 9.41453C1.66131 5.10154 5.19397 1.58655 9.52864 1.58655C11.6291 1.58655 13.6055 2.40355 15.0854 3.88555C15.8182 4.61131 16.3989 5.47457 16.7939 6.42529C17.1889 7.37601 17.3903 8.39528 17.3864 9.42403C17.4055 13.737 13.8729 17.2425 9.53819 17.2425ZM13.8538 11.3905C13.6151 11.2765 12.4502 10.7065 12.2402 10.621C12.0206 10.545 11.8678 10.507 11.7055 10.735C11.5432 10.9725 11.0945 11.5045 10.9608 11.6565C10.8271 11.818 10.6839 11.837 10.4452 11.7135C10.2065 11.5995 9.44271 11.343 8.54523 10.545C7.83869 9.91803 7.37085 9.14853 7.22764 8.91103C7.09397 8.67353 7.20854 8.55003 7.33266 8.42653C7.43769 8.32203 7.57136 8.15103 7.68593 8.01803C7.8005 7.88503 7.84824 7.78053 7.92462 7.62853C8.001 7.46703 7.96281 7.33404 7.90553 7.22004C7.84824 7.10604 7.37085 5.94704 7.1799 5.47204C6.98894 5.01604 6.78844 5.07304 6.64523 5.06354H6.18693C6.02462 5.06354 5.77638 5.12054 5.55678 5.35804C5.34673 5.59554 4.73568 6.16554 4.73568 7.32453C4.73568 8.48353 5.58543 9.60453 5.7 9.75653C5.81457 9.91803 7.37085 12.293 9.73869 13.3095C10.302 13.5565 10.7412 13.699 11.0849 13.8035C11.6482 13.984 12.1638 13.9555 12.5744 13.8985C13.0327 13.832 13.9779 13.3285 14.1688 12.7775C14.3693 12.2265 14.3693 11.761 14.3025 11.6565C14.2357 11.552 14.0925 11.5045 13.8538 11.3905Z";
  }

  async ngOnInit() {
    this.edit=localStorage.getItem("profileSlug")
    this.editFromProfile = localStorage.getItem("editFromProfile") || ""
    const slug = localStorage.getItem("profileSlug")
    if (slug) {
      this.profile = await this.profileService.GetProfileBySlug(slug)
      this.form.patchValue(this.profile)
    }
    if (this.profile.socialLayout) {
      
      // this.items=this.profile.socialLayout
    }

    this.subs.add(this.dragulaService.drop("VAMPIRES").subscribe(({ name, el }) => {
      const layout={socialLayout:this.items,_id:this.profile._id}
      this.profileService.UpdateProfile(layout).then((r)=>{
        console.log(r)
      })

    }))

  }
  async submitForm(): Promise<void> {
    if (!(await this.isValid())) {
      this.errorAlert=true
      return;
    }
    this.errorAlert=false
    this.loading=true
    this.form.value._id = this.profile._id
    console.log(this.form.value)

    let resp = await this.profileService.UpdateProfile(this.form.value)
    console.log(resp)
    this.loading=false
    if (this.saveExsit) {
      localStorage.removeItem("profileSlug")
    localStorage.removeItem("editFromProfile")
    this.router.navigate(["/p/"+this.edit])
    }else{
      
      this.router.navigate(["/onboarding/contact"])
    }
   
  }
  displayFunction(boxName: any) {
    let downArrow = document.getElementById(boxName + "DownArrow")
    let upArrow = document.getElementById(boxName + "UpArrow")
    let inputBox = document.getElementById(boxName + "Input")
    if (!upArrow || !downArrow || !inputBox) {
      return
    }
    if (upArrow.style.display == "none") {
      downArrow.style.display = "none"
      upArrow.style.display = "flex"
      inputBox.style.display = "block"
    } else {
      downArrow.style.display = "flex"
      upArrow.style.display = "none"
      inputBox.style.display = "none"
    }
  }

}
